<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>折腾一下nodejs开发环境 | 老高笔记</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.a95e02d1.css" as="style"><link rel="preload" href="/assets/js/app.18732c23.js" as="script"><link rel="preload" href="/assets/js/3.ee3477e8.js" as="script"><link rel="preload" href="/assets/js/2.438c29d7.js" as="script"><link rel="preload" href="/assets/js/13.6fb41f51.js" as="script"><link rel="prefetch" href="/assets/js/10.12412978.js"><link rel="prefetch" href="/assets/js/11.f08e7872.js"><link rel="prefetch" href="/assets/js/12.bffe24c1.js"><link rel="prefetch" href="/assets/js/14.0883bdf8.js"><link rel="prefetch" href="/assets/js/15.62ff05ba.js"><link rel="prefetch" href="/assets/js/16.5eae74de.js"><link rel="prefetch" href="/assets/js/17.edae1397.js"><link rel="prefetch" href="/assets/js/18.e57db8f2.js"><link rel="prefetch" href="/assets/js/19.d25e9189.js"><link rel="prefetch" href="/assets/js/20.d6d88328.js"><link rel="prefetch" href="/assets/js/21.eb00de78.js"><link rel="prefetch" href="/assets/js/4.b8c9bd84.js"><link rel="prefetch" href="/assets/js/5.0373c51a.js"><link rel="prefetch" href="/assets/js/6.3f0f2157.js"><link rel="prefetch" href="/assets/js/7.1325b268.js"><link rel="prefetch" href="/assets/js/8.7ddafe9a.js"><link rel="prefetch" href="/assets/js/9.51868c2e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a95e02d1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">老高笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content default"><h1 id="折腾一下nodejs开发环境"><a href="#折腾一下nodejs开发环境" aria-hidden="true" class="header-anchor">#</a> 折腾一下nodejs开发环境</h1> <blockquote><p>工欲善其事，必先利其器。在本教程开始之前，让我们先看看手中的利器有哪些</p></blockquote> <ol><li>nodejs 8.5 这个版本的nodejs可以支持更多的es6特性，nodejs8以上版本对新语法有更全面的原生支持 , <a href="http://node.green/" target="_blank" rel="noopener noreferrer">nodejs各版本对ECMASCRIPT标准的支持情况<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>webstorm / vscode  IDE工具 <em>提示： 建议使用最新的webstorm版本(v2017.3),对jest集成度更高</em></li> <li>babel——将es6，es7, es8 编译为 es5或es6</li> <li>eslint——代码质量静态检查以及统一代码风格</li> <li>prettifer——漂亮的代码格式插件，有助于我们统一代码风格， 它也是2017年最另人兴奋的项目</li> <li>lerna——一个微仓库管理工具，有了它我们可以方便的在一个项目里完成对多个npm包的统一管理</li> <li>jest——大厂facebook出品的一个测试框架，不仅支持前端单元测试，还支持nodejs的模块测试</li> <li>nodemon——监控文件变化</li></ol> <h1 id="环境准备"><a href="#环境准备" aria-hidden="true" class="header-anchor">#</a> 环境准备</h1> <ul><li>安装 <strong>nodejs 8.9.4</strong> <a href="https://nodejs.org/en/download/" target="_blank" rel="noopener noreferrer">nodejs下载地址<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>全局安装 <strong>yarn</strong></li> <li>全局安装 <strong>cnpm</strong></li></ul> <h1 id="那我们现在就开始吧"><a href="#那我们现在就开始吧" aria-hidden="true" class="header-anchor">#</a> 那我们现在就开始吧</h1> <p></p><div class="table-of-contents"><ul><li><a href="#第一部分-使用babel编译">第一部分 使用babel编译</a></li><li><a href="#第二部分-用lerna进行多包管理">第二部分 用lerna进行多包管理</a></li><li><a href="#第三部分-eslint和prettier-使用代码规范检查及代码格式化">第三部分 eslint和prettier 使用代码规范检查及代码格式化</a></li></ul></div><p></p> <h2 id="第一部分-使用babel编译"><a href="#第一部分-使用babel编译" aria-hidden="true" class="header-anchor">#</a> 第一部分 使用babel编译</h2> <blockquote><p>先创建一个空目录大家没意见吧？</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>mkdir project-demo

cd project-demo
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p> <p>让我们启动版本控制吧</p></div> <div class="language- extra-class"><pre class="language-text"><code>git init
</code></pre></div><blockquote><p>等等，好像还差点什么对了 <strong>.gitignore</strong> , 有一些文件夹和文件我不希望纳入版本控制，比如 node_modules目录, .idea目录</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code># 我装个X,用shell直接写了，聪明的你用文件编辑器也可以哦

echo &quot;node_modules\n.idea&quot; &gt; .gitignore

</code></pre></div><blockquote><p>各位听众，现在我想在这个工程里使用 <strong>es6,es7</strong> 的新语法，并且希望项目的最终代码可以运行在 <strong>nodejs8</strong> 上，所以我需要安装以下几个模块</p></blockquote> <blockquote><ul><li>babel-core 它是babel的核心模块</li> <li>babel-cli  babel命令行模块，提供了babel-node,有了babel-node我就可以直接运行使用了最新语法的代码，而无需事先编译</li> <li>babel-preset-env  它是一个预设的环境，通过指定 env 我们就可以让最终代码运行在目标环境中，如 node4, node6, node7, node8, node9</li></ul></blockquote> <blockquote><p>好现在我们来安装这几个包，这里我使用 <strong>yarn</strong> 来安装，用 yarn 的好处是，它会在本地缓存安装过的包，当再次安装这些包的时候，它是直接从本地缓存里读取不再从网络下载，速度嘛，嘿嘿谁用谁知道！快得不要不要的！（我美啦美啦美啦）</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>yarn add babel-core babel-cli babel-preset-env
</code></pre></div><blockquote><p>哎？怎么下载这么慢？ ctrl + c , ctrl + c 先中断一下。
F...F...F...K,我居然忘记设置 npm 淘宝镜像了，赶紧设置一下</p></blockquote> <p><strong>推荐阅读 <a href="http://www.infoq.com/cn/articles/nodejs-module-mechanism" target="_blank" rel="noopener noreferrer">深入浅出Node.js（三）：深入Node.js的模块机制<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong></p> <div class="language- extra-class"><pre class="language-text"><code># 全局设置 taobao 镜像
npm config set registry https://registry.npm.taobao.org

# 再安装一次试试
yarn add babel-core babel-cli babel-preset-env
</code></pre></div><blockquote><p>怎么样？是不是快得不要不要的？不信？要不要试试</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code># 把 node_modules 干掉 （嘿嘿 干掉）
rm -rf node_modules

# 再安装一次,感受一下飞一样的感觉
yarn add babel-core babel-cli babel-preset-env

# yarn 的缓存目录是?
yarn cache dir

# yarn 缓存了哪些包？
yarn cache list
</code></pre></div><p><strong>想了解更多 <code>yarn</code> 的功能吗？请移步到 <a href="https://yarnpkg.com/zh-Hans/" target="_blank" rel="noopener noreferrer">yarn官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong></p> <blockquote><p>有点兴奋了，差点忘了正题，言归正转，我们接下来配置一下 <strong>babel</strong>, 如何配置呢， 我们需要在项目根目录下创建一个 <strong>.babelrc</strong> 文件, 并设置目标环境为 <strong>node8</strong></p></blockquote> <p><strong>关于.babelrc的设置请参考 <a href="https://www.npmjs.com/package/babel-preset-env" target="_blank" rel="noopener noreferrer">babel-preset-env<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 以及 <a href="https://babeljs.io/docs/usage/babelrc/" target="_blank" rel="noopener noreferrer">babel官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></strong></p> <div class="language- extra-class"><pre class="language-text"><code>// .babelrc
{
  &quot;presets&quot;: [[
    &quot;env&quot;,
    {
      &quot;targets&quot;: {
        &quot;node&quot;: &quot;8&quot;
      }
    }
  ]]
}
</code></pre></div><blockquote><p>好了，现在 babel 我们已经配置完成了</p></blockquote> <h2 id="第二部分-用lerna进行多包管理"><a href="#第二部分-用lerna进行多包管理" aria-hidden="true" class="header-anchor">#</a> 第二部分 用lerna进行多包管理</h2> <blockquote><p>现在让我隆重介绍下一位重量级角色 <code>lerna</code>, 在文章最开始我已经说过， <code>lerna</code> 是我们手中利器，是的 它实在是太有用了， 真的我不骗你。</p></blockquote> <p><strong><a href="https://lernajs.io/" target="_blank" rel="noopener noreferrer">lerna的官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 上是这样介绍的</strong></p> <blockquote><p>Lerna is a tool that optimizes the workflow around managing multi-package repositories with git and npm.</p> <p>lerna是一个工具，它可以优化使用git和npm管理多包仓库的工作流。</p> <p>我引入 <code>lerna</code> 的目的也正是如此，我想把我的代码拆分成多个 package，又不想给每个 package 都建立一个独立的git仓库， lerna 正好可以帮我解决这个问题，我现在只需要创建一个 git仓库，使用相同的babel配置、单元测试配置以及代码规范及风格配置，就可以编辑并发布多个 package 了。</p></blockquote> <blockquote><p>真的是太爽了！不知道你们爽不爽，反正我爽了！！！</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code># 全局安装 lerna 吧
cnpm i -g lerna

# 在我们的项目根目录下 用 lerna 初始化一下
lerna init
</code></pre></div><blockquote><p>好了，现在我们目录看起来应该是下面的样子</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>.
├── .git
├── .gitignore
├── lerna.json
├── node_modules
├── package.json
├── packages
└── yarn.lock
</code></pre></div><blockquote><p>接下来，我要配置一下 lerna.json</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>// lerna.json
{
  &quot;lerna&quot;: &quot;2.2.0&quot;,
  &quot;packages&quot;: [
    &quot;packages/*&quot;
  ],
  &quot;commands&quot;: {
    &quot;bootstrap&quot;: {
      &quot;hoist&quot;: &quot;**&quot;
    }
  },
  &quot;version&quot;: &quot;0.0.0&quot;,
  &quot;npmClient&quot;: &quot;yarn&quot;
}
</code></pre></div><blockquote><p>为什么这么配？ 客官莫要着急上火， 且听我慢慢道来</p></blockquote> <blockquote><p>实际上当你执行了 <code>lerna init</code> 命令之后，lerna会在项目根目录下创建一个 <code>lerna.json</code>  和  一个<code>packages目录</code>，其中 <code>lerna.json</code> 用于设置lerna相关配置， <code>packages</code> 目录用于存放我们的 <code>package</code>。</p></blockquote> <p>下面是配置思路</p> <blockquote><p>lerna 默认使用 npm 来下载依赖包，在本工程中我希望使用 yarn ， 所以我在 lerna.json 中配置一下 <code>npmClient</code></p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>...
&quot;npmClient&quot;: &quot;yarn&quot;
...
</code></pre></div><blockquote><p>多个 package 可能有相同的依赖，我想把这些相同的依赖提取出来置于最顶层的 <code>node_modules</code> ，好处自然是为了加快依赖包下载速度，好那就用lerna 提供的 <code>hoist</code>（提升）选项，来达到我目的吧</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>...
 &quot;commands&quot;: {
    &quot;bootstrap&quot;: {
      &quot;hoist&quot;: &quot;**&quot;
    }
  },
...
</code></pre></div><blockquote><p>lerna 配置完成</p></blockquote> <h2 id="第三部分-eslint和prettier-使用代码规范检查及代码格式化"><a href="#第三部分-eslint和prettier-使用代码规范检查及代码格式化" aria-hidden="true" class="header-anchor">#</a> 第三部分 eslint和prettier 使用代码规范检查及代码格式化</h2> <p>eslint 和 prettier 果真是一对好基友，eslint 有一些代码规则可以帮我们检测出代码中的一些逻辑或语法错误</p> <ul><li>禁用未声明的变量 (no-undef)</li></ul> <p><img src="media/15177695140745/15179325920381.jpg" alt="-w425"></p> <h1 id="脚手架"><a href="#脚手架" aria-hidden="true" class="header-anchor">#</a> 脚手架</h1> <ul><li>[x] babel环境配置</li> <li>[x] 集成lerna</li> <li>[x] 集成eslint 和 prettier</li></ul></div> <div class="page-edit"><!----> <!----></div> <!----> </div></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.18732c23.js" defer></script><script src="/assets/js/3.ee3477e8.js" defer></script><script src="/assets/js/2.438c29d7.js" defer></script><script src="/assets/js/13.6fb41f51.js" defer></script>
  </body>
</html>
